{% load i18n facebook twitter gravatar staticfiles %}

<div id="container">
    <div id="header">
        <div id="logo">
            <a href="{% url home %}">
                <img src="{% static logo_url %}" alt="PiplMesh" />
            </a>
        </div>
        <div id="search">
            <img id="search_logo" src="{% static "piplmesh/images/google.png" %}" alt="Google" />
            <div id="cse_search_form"></div>
            <script src="https://www.google.com/jsapi" type="text/javascript"></script>
            <script type="text/javascript">
                var language_code = '{{ LANGUAGE_CODE|escapejs }}';
                var search_engine_unique_id = '{{ SEARCH_ENGINE_UNIQUE_ID|escapejs }}';
                var search_page_url = '{% filter escapejs %}{% url search %}{% endfilter %}';
            </script>
            <script type="text/javascript" src="{% static "piplmesh/js/search_bar.js" %}"></script>
            {% if "q" in request.GET %}
                {% trans "See your query results on " %}<a id="google_results_link">Google</a>.
            {% endif %}
        </div>
        {% with next|default:request_get_next|default:request.get_full_path as next_url %}
            <ul class="user">
                {% comment %}
                    This list is used for registration and login link.
                    If user is already logged in, logout link is shown instead.
                {% endcomment %}
                {% if user.is_authenticated %}
                    <li class="image">
                        {% if user.facebook_id %}
                            <img src="{% facebook_picture user.facebook_id "square" %}" alt="{% trans "User picture" %}" />
                        {% elif user.twitter_id %}
                            <img src="{% twitter_picture user.twitter_token_key user.twitter_token_secret %}" alt="{% trans "User picture" %}" />
                        {% else %}
                            {% gravatar user 50 %}
                        {% endif %}
                    </li>
                    <li class="username"><a href="{% url user username=user.username %}">{{ user.username }}</a></li>
                    <li class="last">
                        <form method="post" action="{% url logout %}" id="logout_form">
                            {% csrf_token %}
                            <div>
                                <input type="hidden" name="{{ REDIRECT_FIELD_NAME }}" value="{{ next_url }}" />
                                <button type="submit" class="auth_button" value="value">{% trans "Logout" %}</button>
                            </div>
                        </form>
                    </li>
                {% else %}
                    <li><a href="{% url login %}?{{ REDIRECT_FIELD_NAME }}={{ next_url }}">{% trans "Login" %}</a></li>
                    <li class="last"><a href="{% url registration %}">{% trans "Register" %}</a></li>
                {% endif %}
            </ul>
        {% endwith %}
    </div>
</div>
